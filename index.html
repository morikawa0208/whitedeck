<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>ã™ãã¾ã§ãƒã‚¯ã‚¹ãƒ©ã€æ²¡ã€‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        
        html, body {
            margin: 0;
            padding: 0;
            touch-action: manipulation;
            overscroll-behavior: none;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            align-items: center;
        }

        body.is-booting .app-shell {
            visibility: hidden;
        }

        body.is-booting #boot-overlay {
            display: flex !important;
        }

        .app-shell {
            width: clamp(0px, 100%, 460px);
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
        }

        .page { display: none; height: 100%; min-height: 0; flex-direction: column; overflow-y: auto; }
        .page.active { display: flex; }

        /* Status Bars */
        .bar-container { position: relative; background-color: #e2e8f0; border-radius: 6px; overflow: hidden; height: 20px; border: 1px solid #cbd5e1; width: 100%; }
        .bar-fill { height: 100%; transition: width 0.3s ease; }
        .hp-fill { background-color: #ef4444; }
        .mp-fill { background-color: #3b82f6; }
        .exp-fill { background-color: #fbbf24; }
        .bar-text { position: absolute; inset: 0; display: flex; items-center; justify-content: center; font-size: 10px; font-weight: 800; color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.5); pointer-events: none; }

        @keyframes floatUp {
            0% { opacity: 1; transform: translate(-50%, -50%) translate(var(--offset-x), var(--offset-y)); }
            100% { opacity: 0; transform: translate(-50%, -50%) translate(var(--offset-x), calc(var(--offset-y) - 40px)); }
        }
        .damage-text {
            position: absolute;
            font-weight: 900;
            font-size: 1.5rem;
            animation: floatUp 0.8s forwards;
            pointer-events: none;
            z-index: 100;
            text-shadow: 2px 2px 0 #fff;
            --offset-x: 0px;
            --offset-y: 0px;
            transform: translate(-50%, -50%) translate(var(--offset-x), var(--offset-y));
            white-space: nowrap;
            max-width: 100%;
        }
        #damage-layer {
            overflow: hidden;
        }

        .mini-log {
            font-size: 10px;
            line-height: 1.2;
            mask-image: linear-gradient(to top, black 70%, transparent 100%);
        }

        .rarity-normal { color: #334155; font-weight: bold; }
        .rarity-magic { color: #3b82f6; font-weight: bold; }
        .rarity-rare { color: #facc15; font-weight: bold; }
        .rarity-epic { color: #a855f7; font-weight: bold; }
        .rarity-legendary { color: #a16207; font-weight: bold; text-shadow: 0 0 8px rgba(161, 98, 7, 0.35); }
        .rarity-mythic { color: #7c3aed; font-weight: bold; text-shadow: 0 0 10px rgba(250, 204, 21, 0.55); }

        .drop-log-box {
            font-size: 10px;
            line-height: 1.2;
            mask-image: linear-gradient(to top, black 70%, transparent 100%);
        }
        .drop-log-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            line-height: 1.2;
        }
        .drop-log-item i {
            color: #94a3b8;
        }

        .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        nav button.active { color: #0f172a; border-top: 3px solid #0f172a; background-color: #fff; }
        .type-tab.active { border-bottom: 3px solid #0f172a; color: #0f172a; font-weight: bold; }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        .boss-visual {
            color: #f59e0b;
            text-shadow: 0 0 12px rgba(245, 158, 11, 0.6);
            animation: bossPulse 1.8s ease-in-out infinite;
        }
        .boss-name {
            color: #b45309;
            text-shadow: 0 0 6px rgba(245, 158, 11, 0.35);
        }
        .boss-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 0.2em;
            padding: 4px 10px;
            border-radius: 9999px;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: #fff7ed;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
        }
        @keyframes bossPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.06); }
        }

        .item-name-shrink {
            font-size: 0.72rem;
            line-height: 1.1;
        }

        .item-stat-categories {
            display: flex;
            gap: 8px;
            align-items: flex-start;
            flex-wrap: nowrap;
        }

        .item-stat-group {
            min-width: 0;
            flex: 1;
        }

        .item-stat-group-title {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 9px;
            font-weight: 900;
            color: #94a3b8;
            text-transform: uppercase;
            margin-bottom: 2px;
        }

        .item-unique-block {
            margin-top: 6px;
            padding: 6px 8px;
            border-radius: 8px;
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.35);
        }

        .enhance-label {
            font-size: 0.7rem;
            font-weight: 900;
            letter-spacing: 0.02em;
        }
        .enhance-green { color: #22c55e; }
        .enhance-yellow { color: #facc15; }
        .enhance-blue { color: #38bdf8; }
        .enhance-pink { color: #f472b6; }
        .enhance-orange { color: #fb923c; }
        .enhance-gold { color: #f59e0b; text-shadow: 0 0 6px rgba(245, 158, 11, 0.55); }
        .enhance-white { color: #f8fafc; text-shadow: 0 0 4px rgba(15, 23, 42, 0.8); }
        .enhance-broken { color: #ef4444; font-size: 0.6rem; font-weight: 900; letter-spacing: 0.08em; }
        .enhance-rattle { animation: shake 0.35s cubic-bezier(.36,.07,.19,.97) infinite; }
        .enhance-glow-success { animation: enhanceGlow 1.2s ease-in-out infinite; }
        .enhance-glow-fail { animation: enhanceFade 1.2s ease-in-out infinite; }
        @keyframes enhanceGlow {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { transform: scale(1.04); box-shadow: 0 0 20px rgba(34, 197, 94, 0.5); }
        }
        @keyframes enhanceFade {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(0.98); opacity: 0.6; }
        }

        .drop-log-item.rarity-legendary {
            background: linear-gradient(120deg, rgba(251, 191, 36, 0.24), rgba(30, 41, 59, 0.2));
            border: 1px solid rgba(251, 191, 36, 0.6);
            border-radius: 9999px;
            padding: 2px 8px;
            box-shadow: 0 0 12px rgba(251, 191, 36, 0.35);
            animation: legendaryLogGlow 2.4s ease-in-out infinite;
        }
        .drop-log-item.rarity-legendary i {
            color: #fbbf24;
        }
        @keyframes legendaryLogGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: 0 0 18px rgba(251, 191, 36, 0.55); }
        }

        .feedback-embed {
            width: 100%;
            height: clamp(420px, 70dvh, 760px);
            border: 0;
        }

        #action-btn,
        #action-btn * {
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        .preset-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1px 6px;
            border-radius: 9999px;
            font-size: 9px;
            font-weight: 900;
            letter-spacing: 0.04em;
            background-color: #e2e8f0;
            color: #334155;
            border: 1px solid #cbd5e1;
        }
    </style>
</head>
<body class="is-booting flex flex-col">
    <div class="app-shell">

    <!-- TOP BAR -->
    <header class="h-12 border-b flex items-center justify-between px-4 shrink-0 bg-white z-50 shadow-sm">
        <div class="font-bold flex items-center gap-2">
            <span class="text-slate-700 text-sm">ã™ãã¾ã§ãƒã‚¯ã‚¹ãƒ©</span>
        </div>
        <div class="flex items-center gap-3">
            <span class="text-[10px] bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-bold">SP: <span id="header-sp">0</span></span>
            <span class="text-[10px] bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full font-bold"><i class="fas fa-coins"></i> <span id="header-gold">0</span>G</span>
            <div class="bg-slate-800 text-white text-[10px] px-2 py-1 rounded font-bold">Lv.<span id="header-lvl">1</span></div>
        </div>
    </header>

    <!-- CONTENT PAGES -->
    <main class="flex-1 overflow-hidden relative min-h-0">
        
        <!-- BATTLE PAGE -->
        <section id="page-battle" class="page active p-4" style="padding-top: 4px">
            <div class="flex-1 flex flex-col items-center justify-center relative min-h-[200px]">
                <div class="absolute right-2 top-2 z-10 flex items-center gap-2">
                    <label class="flex items-center gap-1.5 bg-white/90 text-slate-600 text-[12px] font-bold px-3 py-2 rounded-full shadow border border-slate-200">
                        <input id="rematch-toggle" type="checkbox" class="accent-slate-800">
                        å†æˆ¦
                    </label>
                    <button id="warp-btn" class="bg-slate-800 text-white text-xs font-black px-3 py-2 rounded-full shadow flex items-center gap-2 hover:bg-slate-700 active:scale-95 transition">
                        <i class="fas fa-location-arrow"></i>
                        ãƒ¯ãƒ¼ãƒ—
                    </button>
                </div>
                <div id="enemy-container" class="text-center transition-all duration-300">
                    <div id="enemy-visual" class="text-8xl mb-4 text-slate-700"><i class="fas fa-ghost"></i></div>
                                <div id="enemy-name" class="font-bold text-lg mb-1">ã‚¹ãƒ©ã‚¤ãƒ </div>
                <div id="enemy-boss-badge" class="hidden justify-center mb-2">
                    <span class="boss-badge"><i class="fas fa-crown"></i> BOSS</span>
                </div>
                <div class="w-48 bar-container mx-auto mb-1 border-0 bg-slate-200">
                    <div id="enemy-hp-bar" class="bar-fill hp-fill"></div>
                    <div class="bar-text">HP: <span id="enemy-hp-text">30/30</span></div>
                </div>
            </div>
                <div id="damage-layer" class="absolute inset-0 pointer-events-none"></div>
                <div class="absolute left-0 bottom-4 w-1/2 drop-log-box pointer-events-none text-left pl-2 text-slate-500 italic">
                    <div id="drop-log-list" class="flex flex-col-reverse gap-1"></div>
                </div>
                <div class="absolute right-0 bottom-4 w-1/2 mini-log pointer-events-none text-right pr-2 text-slate-500 italic space-y-1">
                    <div id="mini-log-9"></div>
                    <div id="mini-log-8"></div>
                    <div id="mini-log-7"></div>
                    <div id="mini-log-6"></div>
                    <div id="mini-log-5"></div>
                    <div id="mini-log-4"></div>
                    <div id="mini-log-3"></div>
                    <div id="mini-log-2"></div>
                    <div id="mini-log-1"></div>
                    <div id="mini-log-0" class="text-slate-800 font-bold"></div>
                </div>
            </div>

            <!-- Player Status Section -->
            <div class="bg-white border rounded-2xl p-4 shadow-sm space-y-3 mb-2">
                <div class="space-y-1.5">
                    <div class="bar-container">
                        <div id="player-hp-bar" class="bar-fill hp-fill"></div>
                        <div class="bar-text">HP: <span id="player-hp-text">100/100</span></div>
                    </div>
                    <div class="bar-container">
                        <div id="player-mp-bar" class="bar-fill mp-fill"></div>
                        <div class="bar-text">MP: <span id="player-mp-text">30/30</span></div>
                    </div>
                    <div class="bar-container">
                        <div id="player-exp-bar-battle" class="bar-fill exp-fill"></div>
                        <div class="bar-text">EXP: <span id="player-exp-text-battle">0/100</span></div>
                    </div>
                </div>

                <button id="action-btn" class="w-full bg-slate-800 text-white font-black py-4 rounded-2xl shadow-lg active:scale-95 transition-transform text-lg flex items-center justify-center gap-2">
                    <i class="fas fa-sword"></i> <span>æ”»æ’ƒ</span>
                </button>
            </div>
            
            <div id="death-overlay" class="absolute inset-0 bg-red-900/40 backdrop-blur-[2px] hidden items-center justify-center z-50">
                <div class="bg-white p-8 rounded-3xl shadow-2xl text-center border-2 border-red-500 mx-4">
                    <div class="text-6xl mb-4">ğŸ’€</div>
                    <h2 class="text-2xl font-black text-red-600 mb-2">YOU DIED</h2>
                    <p class="text-sm text-slate-500 mb-2">ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š</p>
                    <div class="text-xs text-red-600 font-bold mb-6 bg-red-50 p-3 rounded-xl">
                        çµŒé¨“å€¤ãƒ­ã‚¹ãƒˆ: <span id="lost-exp-val">-</span>
                    </div>
                    <button onclick="revive()" class="w-full bg-red-600 text-white font-bold px-8 py-4 rounded-xl shadow-lg active:scale-95">è¡—ã«æˆ»ã‚‹</button>
                </div>
            </div>
        </section>

        <!-- SAVE PAGE -->
        <section id="page-save" class="page p-4 bg-slate-50">
            <div class="flex items-center justify-between mb-4 px-2">
                <h2 class="text-xl font-black flex items-center gap-2"><i class="fas fa-floppy-disk"></i> ã‚»ãƒ¼ãƒ–</h2>
            </div>
            <div id="save-section" class="bg-white rounded-3xl p-6 shadow-sm mb-6">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-black text-slate-700 flex items-center gap-2"><i class="fas fa-floppy-disk"></i> ã‚»ãƒ¼ãƒ–/ãƒ­ãƒ¼ãƒ‰</h3>
                    <span id="autosave-indicator" class="text-[10px] text-emerald-600 font-bold">ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–: ã‚¹ãƒ­ãƒƒãƒˆ1</span>
                </div>
                <p class="text-[10px] text-slate-500 mb-3">30ç§’ã”ã¨ã«é¸æŠã—ãŸã‚¹ãƒ­ãƒƒãƒˆã¸è‡ªå‹•ä¿å­˜ã—ã¾ã™ã€‚</p>
                <div id="save-status" class="text-[10px] text-slate-400 mb-3">æœªä¿å­˜</div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <button id="switch-save-slot-btn" class="py-2 rounded-xl bg-slate-100 text-slate-600 text-[10px] font-black flex items-center justify-center gap-2">
                        <i class="fas fa-right-left"></i> ã‚¹ãƒ­ãƒƒãƒˆåˆ‡æ›¿
                    </button>
                    <button id="new-save-btn" class="py-2 rounded-xl bg-rose-50 text-rose-600 text-[10px] font-black flex items-center justify-center gap-2">
                        <i class="fas fa-trash-can"></i> æ–°ã—ãå§‹ã‚ã‚‹
                    </button>
                </div>
                <div class="space-y-3">
                    <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
                        <div class="flex items-center justify-between gap-2">
                            <div>
                                <div class="text-xs font-black text-slate-700">ã‚¹ãƒ­ãƒƒãƒˆ1</div>
                                <div id="save-slot-info-1" class="text-[10px] text-slate-400">ç©º</div>
                            </div>
                            <label class="text-[9px] font-bold text-slate-500 flex items-center gap-1">
                                <input type="radio" name="autosave-slot" value="1" class="accent-slate-800">
                                ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–
                            </label>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button data-save-slot="1" class="flex-1 py-2 rounded-xl bg-slate-800 text-white text-[10px] font-black flex items-center justify-center gap-1">
                                <i class="fas fa-floppy-disk"></i> ã‚»ãƒ¼ãƒ–
                            </button>
                            <button data-load-slot="1" class="flex-1 py-2 rounded-xl bg-slate-200 text-slate-700 text-[10px] font-black flex items-center justify-center gap-1">
                                <i class="fas fa-download"></i> ãƒ­ãƒ¼ãƒ‰
                            </button>
                        </div>
                    </div>
                    <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
                        <div class="flex items-center justify-between gap-2">
                            <div>
                                <div class="text-xs font-black text-slate-700">ã‚¹ãƒ­ãƒƒãƒˆ2</div>
                                <div id="save-slot-info-2" class="text-[10px] text-slate-400">ç©º</div>
                            </div>
                            <label class="text-[9px] font-bold text-slate-500 flex items-center gap-1">
                                <input type="radio" name="autosave-slot" value="2" class="accent-slate-800">
                                ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–
                            </label>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button data-save-slot="2" class="flex-1 py-2 rounded-xl bg-slate-800 text-white text-[10px] font-black flex items-center justify-center gap-1">
                                <i class="fas fa-floppy-disk"></i> ã‚»ãƒ¼ãƒ–
                            </button>
                            <button data-load-slot="2" class="flex-1 py-2 rounded-xl bg-slate-200 text-slate-700 text-[10px] font-black flex items-center justify-center gap-1">
                                <i class="fas fa-download"></i> ãƒ­ãƒ¼ãƒ‰
                            </button>
                        </div>
                    </div>
                    <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3">
                        <div class="flex items-center justify-between gap-2">
                            <div>
                                <div class="text-xs font-black text-slate-700">ã‚¹ãƒ­ãƒƒãƒˆ3</div>
                                <div id="save-slot-info-3" class="text-[10px] text-slate-400">ç©º</div>
                            </div>
                            <label class="text-[9px] font-bold text-slate-500 flex items-center gap-1">
                                <input type="radio" name="autosave-slot" value="3" class="accent-slate-800">
                                ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–
                            </label>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <button data-save-slot="3" class="flex-1 py-2 rounded-xl bg-slate-800 text-white text-[10px] font-black flex items-center justify-center gap-1">
                                <i class="fas fa-floppy-disk"></i> ã‚»ãƒ¼ãƒ–
                            </button>
                            <button data-load-slot="3" class="flex-1 py-2 rounded-xl bg-slate-200 text-slate-700 text-[10px] font-black flex items-center justify-center gap-1">
                                <i class="fas fa-download"></i> ãƒ­ãƒ¼ãƒ‰
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4">
                    <div class="flex items-center justify-between gap-2 mb-2">
                        <h4 class="text-[11px] font-black text-slate-700 flex items-center gap-2">
                            <i class="fas fa-file-export"></i> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ / ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                        </h4>
                        <span class="text-[9px] text-slate-400">ç¾åœ¨ã®ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ã‚¹ãƒ­ãƒƒãƒˆã‚’å¯¾è±¡</span>
                    </div>
                    <p class="text-[10px] text-slate-500 mb-3">
                        æ–‡å­—åˆ—ã‚³ãƒ”ãƒ¼ã§ä»–ç«¯æœ«ã¸å¼•ãç¶™ã’ã¾ã™ã€‚
                    </p>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="rounded-xl border border-slate-200 bg-slate-50 p-3 space-y-2">
                            <div class="flex items-center justify-between gap-2">
                                <span class="text-[10px] font-black text-slate-600 flex items-center gap-1">
                                    <i class="fas fa-copy"></i> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ–‡å­—åˆ—
                                </span>
                                <button id="export-refresh-btn" class="text-[9px] font-black px-2 py-1 rounded-full bg-slate-800 text-white">
                                    å¼•ãç¶™ãã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
                                </button>
                            </div>
                            <textarea id="export-text" class="w-full h-20 rounded-lg border border-slate-200 bg-white p-2 text-[9px] text-slate-600" readonly></textarea>
                            <div id="export-copy-message" class="text-[9px] text-emerald-600 font-bold hidden">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>
                            <div class="flex items-center gap-2">
                                <button id="export-copy-btn" class="flex-1 py-2 rounded-xl bg-slate-800 text-white text-[10px] font-black flex items-center justify-center gap-1">
                                    <i class="fas fa-copy"></i> ã‚³ãƒ”ãƒ¼
                                </button>
                                <button id="export-clear-btn" class="flex-1 py-2 rounded-xl bg-slate-200 text-slate-700 text-[10px] font-black flex items-center justify-center gap-1">
                                    <i class="fas fa-eraser"></i> ã‚¯ãƒªã‚¢
                                </button>
                            </div>
                        </div>

                        <div class="rounded-xl border border-slate-200 bg-slate-50 p-3 space-y-2">
                            <span class="text-[10px] font-black text-slate-600 flex items-center gap-1">
                                <i class="fas fa-file-import"></i> ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡å­—åˆ—
                            </span>
                            <div class="flex items-center justify-between gap-2 text-[9px] text-slate-500">
                                <span class="font-bold flex items-center gap-1">
                                    <i class="fas fa-bullseye"></i> å–ã‚Šè¾¼ã¿å…ˆã‚¹ãƒ­ãƒƒãƒˆ
                                </span>
                                <select id="import-slot-select" class="rounded-lg border border-slate-200 bg-white px-2 py-1 text-[9px] text-slate-600">
                                    <option value="auto">ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–</option>
                                    <option value="1">ã‚¹ãƒ­ãƒƒãƒˆ1</option>
                                    <option value="2">ã‚¹ãƒ­ãƒƒãƒˆ2</option>
                                    <option value="3">ã‚¹ãƒ­ãƒƒãƒˆ3</option>
                                </select>
                            </div>
                            <textarea id="import-text" class="w-full h-20 rounded-lg border border-slate-200 bg-white p-2 text-[9px] text-slate-600" placeholder="ã“ã“ã«è²¼ã‚Šä»˜ã‘"></textarea>
                            <div class="flex items-center gap-2">
                                <button id="import-apply-btn" class="flex-1 py-2 rounded-xl bg-emerald-600 text-white text-[10px] font-black flex items-center justify-center gap-1">
                                    <i class="fas fa-upload"></i> å–ã‚Šè¾¼ã¿
                                </button>
                                <button id="import-clear-btn" class="flex-1 py-2 rounded-xl bg-slate-200 text-slate-700 text-[10px] font-black flex items-center justify-center gap-1">
                                    <i class="fas fa-eraser"></i> ã‚¯ãƒªã‚¢
                                </button>
                            </div>
                            <div id="import-tamper-message" class="text-[9px] text-rose-500 font-bold hidden">
                                æ”¹ã–ã‚“ãŒæ¤œå‡ºã•ã‚ŒãŸãŸã‚å–ã‚Šè¾¼ã¿ã‚’æ‹’å¦ã—ã¾ã—ãŸã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- STATUS PAGE -->
        <section id="page-status" class="page p-4 bg-slate-50">
            
            <!-- Summary Card -->
            <div class="bg-white rounded-3xl p-6 shadow-sm mb-4">
                <div class="flex items-center justify-between border-b pb-4 mb-4">
                    <div>
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Level</div>
                        <div class="text-4xl font-black" id="status-lvl">1</div>
                    </div>
                    <div class="text-right">
                        <div class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Experience</div>
                        <div class="text-sm font-bold"><span id="status-exp">0</span> / <span id="status-next">100</span></div>
                        <div class="w-32 bar-container h-2 mt-1 border-0 bg-slate-100"><div id="status-exp-bar" class="bar-fill exp-fill"></div></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-y-6 gap-x-4">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 font-bold uppercase">STR (ç‰©ç†æ”»æ’ƒ)</span>
                        <span class="text-2xl font-black text-slate-700" id="status-atk">10</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 font-bold uppercase">VIT (ç‰©ç†é˜²å¾¡)</span>
                        <span class="text-2xl font-black text-slate-700" id="status-def">5</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 font-bold uppercase">INT (é­”æ³•å¨åŠ›)</span>
                        <span class="text-2xl font-black text-blue-600" id="status-int">5</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 font-bold uppercase">DEX (å™¨ç”¨ã•)</span>
                        <span class="text-2xl font-black text-green-600" id="status-dex">5</span>
                    </div>
                </div>
            </div>

            <!-- Detailed Stats -->
            <div class="bg-slate-800 rounded-3xl p-6 text-white mb-6">
                <div class="flex items-center justify-between mb-4 border-b border-slate-700 pb-2">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-tighter">Secondary Attributes</h3>
                    <button id="secondary-info-btn" class="text-slate-400 hover:text-white transition-colors text-xs font-bold flex items-center gap-1">
                        <i class="fas fa-circle-info"></i> Info
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4 text-xs">
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>æœ€å¤§HP</span><span id="stat-max-hp">0</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>æœ€å¤§MP</span><span id="stat-max-mp">0</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>HPè‡ªå‹•å›å¾©</span><span id="stat-hp-regen">0</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>MPè‡ªå‹•å›å¾©</span><span id="stat-mp-regen">0</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>æ”»æ’ƒåŠ›</span><span id="stat-atk-flat">0</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>é˜²å¾¡åŠ›</span><span id="stat-def-flat">0</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>å‘½ä¸­ç‡</span><span id="stat-accuracy">95%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ä¼šå¿ƒç‡</span><span id="stat-crit">5%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ä¼šå¿ƒãƒ€ãƒ¡ãƒ¼ã‚¸</span><span id="stat-crit-dmg">200%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ä¸ãƒ€ãƒ¡å¢—åŠ </span><span id="stat-dmg-boost">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>è¢«ãƒ€ãƒ¡è»½æ¸›</span><span id="stat-dmg-reduction">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>å›é¿ç‡</span><span id="stat-eva">3%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>å¸è¡€ç‡</span><span id="stat-leech">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>é­”æ³•è²«é€š</span><span id="stat-m-pen">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>è¿½åŠ çµŒé¨“å€¤</span><span id="stat-exp-boost">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ãƒ‰ãƒ­ãƒƒãƒ—ç‡</span><span id="stat-luck">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ãƒ¬ã‚¢ãƒ‰ãƒ­ç‡</span><span id="stat-rare-find">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>Affixç‡</span><span id="stat-affix-find">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ã‚¨ãƒªãƒ¼ãƒˆé­é‡ç‡</span><span id="stat-elite-encounter">0%</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1"><span>ã‚´ãƒ¼ãƒ«ãƒ‰å¢—åŠ ç‡</span><span id="stat-gold-boost">0%</span></div>
                </div>
            </div>

            <!-- Equipment -->
            <div id="active-preset-tags" class="mb-3 px-1 text-[10px] font-black text-slate-500 flex flex-wrap items-center gap-1"></div>
            <div class="space-y-3 mb-12">
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-khanda text-slate-300"></i>
                        <span>Weapon Slot</span>
                    </div>
                    <div id="equip-weapon" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="weapon-val" class="mt-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-shield-halved text-slate-300"></i>
                        <span>Armor Slot</span>
                    </div>
                    <div id="equip-armor" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="armor-val" class="mt-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-helmet-safety text-slate-300"></i>
                        <span>Helm Slot</span>
                    </div>
                    <div id="equip-head" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="head-val" class="mt-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-hand text-slate-300"></i>
                        <span>Hand Slot</span>
                    </div>
                    <div id="equip-hands" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="hands-val" class="mt-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-shoe-prints text-slate-300"></i>
                        <span>Foot Slot</span>
                    </div>
                    <div id="equip-feet" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="feet-val" class="mt-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-gem text-slate-300"></i>
                        <span>Accessory Slot 1</span>
                    </div>
                    <div id="equip-accessory1" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="accessory1-val" class="mt-1"></div>
                </div>
                <div class="bg-white p-4 rounded-2xl border shadow-sm">
                    <div class="text-[9px] text-slate-400 font-black uppercase tracking-widest mb-1 flex items-center gap-1">
                        <i class="fas fa-gem text-slate-300"></i>
                        <span>Accessory Slot 2</span>
                    </div>
                    <div id="equip-accessory2" class="font-black text-[11px] leading-tight whitespace-normal break-words">ãªã—</div>
                    <div id="accessory2-val" class="mt-1"></div>
                </div>
            </div>
        </section>

        <!-- SKILL PAGE -->
        <section id="page-skill" class="page bg-slate-50 flex-col h-full min-h-0">
            <div class="p-4 bg-white border-b shrink-0">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-black flex items-center gap-2"><i class="fas fa-star"></i> ã‚¹ã‚­ãƒ«</h2>
                </div>
            </div>
            <div class="flex-1 p-4 overflow-y-auto">
                <div class="bg-white border rounded-2xl p-6 text-center text-slate-500 font-bold">-</div>
            </div>
        </section>

        <!-- INVENTORY PAGE -->
        <section id="page-inventory" class="page p-4 bg-slate-50">
            <div class="flex items-center justify-between mb-4 px-2">
                <h2 class="text-xl font-black flex items-center gap-2"><i class="fas fa-box-open"></i> æŒã¡ç‰©</h2>
                <span class="text-[10px] font-bold text-slate-400 bg-slate-200 px-2 py-0.5 rounded-full"><span id="inv-count">0</span> / âˆ</span>
            </div>
            <div id="inventory-list" class="flex-1 overflow-y-auto space-y-2 pb-12"></div>
            <div class="bg-white rounded-2xl border p-3 mt-3 shadow-sm">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-0.5">
                        <button id="build-preset-open" class="px-3 py-2 rounded-xl border text-[8px] font-black flex items-center gap-2 bg-indigo-50 text-indigo-600 border-indigo-200">
                            <i class="fas fa-layer-group"></i>
                            <span>ãƒ—ãƒªã‚»ãƒƒãƒˆ</span>
                        </button>
                        
                        <button id="inv-sort-toggle" onclick="toggleInventorySort()" class="px-3 py-2 rounded-xl border text-[8px] font-black flex items-center gap-2 bg-slate-50 text-slate-500 border-slate-200">
                            <i class="fas fa-clock"></i>
                            <span id="inv-sort-label">å…¥æ‰‹é †</span>
                        </button>
                        <button id="loot-filter-open" class="px-3 py-2 rounded-xl border text-[8px] font-black flex items-center gap-2 bg-slate-50 text-slate-500 border-slate-200">
                            <i class="fas fa-filter"></i>
                            <span>å–å¾—è¨­å®š</span>
                        </button>
                        <button id="bulk-sell-open" class="px-3 py-2 rounded-xl border text-[8px] font-black flex items-center gap-2 bg-slate-50 text-slate-500 border-slate-200">
                            <i class="fas fa-sack-dollar"></i>
                            <span>ä¸€æ‹¬å£²å´</span>
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-8 gap-2 text-[10px] font-bold">
                    <button data-inv-filter="all" onclick="setInventoryFilter('all')" class="inv-filter-btn py-2 rounded-xl border">å…¨ã¦</button>
                    <button data-inv-filter="weapon" onclick="setInventoryFilter('weapon')" class="inv-filter-btn py-2 rounded-xl border">æ­¦å™¨</button>
                    <button data-inv-filter="armor" onclick="setInventoryFilter('armor')" class="inv-filter-btn py-2 rounded-xl border">é§</button>
                    <button data-inv-filter="head" onclick="setInventoryFilter('head')" class="inv-filter-btn py-2 rounded-xl border">å…œ</button>
                    <button data-inv-filter="hands" onclick="setInventoryFilter('hands')" class="inv-filter-btn py-2 rounded-xl border">æ‰‹</button>
                    <button data-inv-filter="feet" onclick="setInventoryFilter('feet')" class="inv-filter-btn py-2 rounded-xl border">è¶³</button>
                    <button data-inv-filter="accessory" onclick="setInventoryFilter('accessory')" class="inv-filter-btn py-2 rounded-xl border col-span-3">è£…é£¾å“</button>
                    <button data-inv-filter="potion" onclick="setInventoryFilter('potion')" class="inv-filter-btn py-2 rounded-xl border col-span-3">è–¬</button>
                </div>
            </div>
        </section>

        <!-- LOG PAGE -->
        <section id="page-log" class="page p-4 bg-slate-900 text-slate-300 font-mono text-[10px]">
            <h2 class="text-slate-500 border-b border-slate-800 pb-2 mb-2 uppercase tracking-widest font-black">System History Log</h2>
            <div id="full-log-container" class="flex-1 overflow-y-auto space-y-1"></div>
        </section>

        <!-- HELP PAGE -->
        <section id="page-help" class="page p-4 bg-slate-50">
            <div class="flex items-start justify-between mb-4 px-2">
                <h2 class="text-xl font-black flex items-center gap-2"><i class="fas fa-circle-question"></i> ãƒ˜ãƒ«ãƒ—</h2>
            </div>
            <div class="bg-white rounded-3xl p-6 shadow-sm space-y-4">
                <div>

            <p class="text-[10px] text-slate-500 mt-2">
              ã„ã¤ã‚‚éŠã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
            </p>
         </div>
               
                <div class="space-y-4 text-sm">

                    <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4 space-y-2">
                        <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest">è£…å‚™å¼·åŒ–</div>
                        <ul class="text-xs text-slate-500 space-y-1">
                            <li>å¯¾è±¡: ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»¥å¤–ã®è£…å‚™å“ï¼ˆæ­¦å™¨/é˜²å…·/è£…é£¾å“ï¼‰ã€‚</li>
                            <li>æˆåŠŸæ™‚ã¯åŸºç¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå¼·åŒ–å€¤1ã”ã¨ã«+3%å¢—åŠ ï¼ˆæ¬¡ã®å¼·åŒ–å€¤åˆ†ã ã‘åæ˜ ï¼‰ã€‚</li>
                            <li>å¼·åŒ–è²»ç”¨ã¯å¼·åŒ–å€¤ãŒé«˜ã„ã»ã©ä¸Šæ˜‡ã€‚</li>
                            <li>å¤±æ•—ãƒšãƒŠãƒ«ãƒ†ã‚£: +5ã¾ã§å¤‰åŒ–ãªã— / +6ã€œ+9ã¯1ä½ä¸‹ / +10ä»¥ä¸Šã¯ç ´æã—ã¦ä¿®ç†ãŒå¿…è¦ã€‚</li>
                        </ul>
                    </div>
                    
                    <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
                        <div class="text-xs text-slate-500 font-bold">-</div>
                    </div>

                </div>
            </div>
        </section>

        <!-- FEEDBACK PAGE -->
        <section id="page-feedback" class="page p-4 bg-slate-50 flex-col gap-3">
            <div class="flex items-start justify-between px-2">
                <h2 class="text-xl font-black flex items-center gap-2"><i class="fas fa-comment-dots"></i> æ„Ÿæƒ³ãƒ»è¦æœ›</h2>
            </div>
            <div class="bg-white rounded-3xl p-3 shadow-sm flex-1 min-h-0">
                <iframe class="feedback-embed" src="https://docs.google.com/forms/d/e/1FAIpQLSehb6HL2A69toW9cmKpbNiUYmkd8FCZRXImFKVzzcPbPwu2sw/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0">èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™â€¦</iframe>
            </div>
        </section>

    </main>

    <!-- BOTTOM NAV -->
    <div id="bottom-menu-backdrop" class="fixed inset-0 z-[45] hidden" aria-hidden="true"></div>
    <div id="bottom-menu-panel" class="fixed left-1/2 -translate-x-1/2 bottom-20 z-[60] hidden" style="width: min(420px, calc(100% - 2rem));">
        <div class="bg-white border border-slate-200 rounded-2xl shadow-2xl px-3 py-3">
            <div class="grid grid-cols-5 gap-2 text-[10px] font-black text-slate-700">
                
                <button onclick="openBottomMenuSave()" class="flex flex-col items-center justify-center gap-1 rounded-xl border border-slate-200 bg-slate-50 py-2 active:scale-95 transition-transform">
                    <i class="fas fa-floppy-disk text-base text-slate-500"></i>
                    ã‚»ãƒ¼ãƒ–
                </button>
                <button onclick="openBottomMenuHelp()" class="flex flex-col items-center justify-center gap-1 rounded-xl border border-slate-200 bg-slate-50 py-2 active:scale-95 transition-transform">
                    <i class="fas fa-circle-question text-base text-slate-500"></i>
                    ãƒ˜ãƒ«ãƒ—
                </button>
                <button onclick="openBottomMenuTweet(event)" class="flex flex-col items-center justify-center gap-1 rounded-xl border border-slate-200 bg-slate-50 py-2 active:scale-95 transition-transform">
                    <i class="fa-brands fa-twitter text-base text-slate-500"></i>
                    ãƒ„ã‚¤ãƒ¼ãƒˆ
                </button>
                <button onclick="openBottomMenuFeedback()" class="flex flex-col items-center justify-center gap-1 rounded-xl border border-slate-200 bg-slate-50 py-2 active:scale-95 transition-transform">
                    <i class="fas fa-comment-dots text-base text-slate-500"></i>
                    æ„Ÿæƒ³ãƒ»è¦æœ›
                </button>
            </div>
        </div>
    </div>
    <nav class="h-16 border-t bg-white grid grid-cols-6 shrink-0 items-center pb-1 z-50 relative shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
        <button onclick="switchPage('battle')" id="nav-battle" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-slate-300 transition-all">
            <i class="fas fa-hand-fist text-xl"></i><span class="text-[9px] font-black">æˆ¦é—˜</span>
        </button>
        <button onclick="switchPage('status')" id="nav-status" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-slate-300 transition-all">
            <i class="fas fa-user-circle text-xl"></i><span class="text-[9px] font-black">èƒ½åŠ›</span>
        </button>
        <button onclick="switchPage('skill')" id="nav-skill" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-slate-300 transition-all relative">
            <i class="fas fa-star text-xl"></i><span class="text-[9px] font-black">ã‚¹ã‚­ãƒ«</span>
        </button>
        <button onclick="switchPage('inventory')" id="nav-inventory" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-slate-300 transition-all relative">
            <i class="fas fa-box-open text-xl"></i><span class="text-[9px] font-black">è£…å‚™</span>
        </button>
        <button onclick="switchPage('log')" id="nav-log" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-slate-300 transition-all">
            <i class="fas fa-scroll text-xl"></i><span class="text-[9px] font-black">å±¥æ­´</span>
        </button>
        <button onclick="toggleBottomMenu()" id="nav-help" aria-controls="bottom-menu-panel" aria-expanded="false" class="flex-1 h-full flex flex-col items-center justify-center gap-1 text-slate-300 transition-all">
            <i class="fas fa-bars text-xl"></i><span class="text-[9px] font-black">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
        </button>
        <button id="nav-save" class="hidden" aria-hidden="true" tabindex="-1"></button>
    </nav>

    <!-- LOOT MODAL -->
    <div id="loot-modal" class="fixed inset-0 bg-slate-900/80 z-[100] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-xs rounded-[2rem] overflow-hidden shadow-2xl transform scale-100 p-8 text-center border-b-8 border-slate-200">
            <div class="text-6xl mb-6">ğŸ“¦</div>
            <h3 class="font-black text-xl mb-2">æˆ¦åˆ©å“ã‚’ç™ºè¦‹ï¼</h3>
            <div id="loot-display" class="bg-slate-50 rounded-2xl p-6 my-4 border border-slate-100"></div>
            <div class="flex gap-3">
                <button onclick="closeLoot(false)" class="flex-1 py-4 text-sm font-bold text-slate-400 bg-slate-100 rounded-2xl">æ¨ã¦ã‚‹</button>
                <button onclick="closeLoot(true)" class="flex-1 py-4 text-sm font-bold text-white bg-slate-800 rounded-2xl shadow-lg">æ‹¾ã†</button>
            </div>
        </div>
    </div>

    <!-- LOOT FILTER MODAL -->
    <div id="loot-filter-modal" class="fixed inset-0 bg-slate-900/80 z-[105] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-slate-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-black text-lg text-slate-800 flex items-center gap-2">
                    <i class="fas fa-filter text-slate-500"></i> å–å¾—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                </h3>
                <button id="loot-filter-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <p class="text-xs text-slate-500 mb-4">ãƒã‚§ãƒƒã‚¯ã—ãŸãƒ¬ã‚¢åº¦ã¯æ‹¾ã‚ãšã€å‰Šé™¤æ‰±ã„ã«ã—ã¾ã™ã€‚</p>
            <div class="space-y-2 text-sm">
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-normal">
                        <input type="checkbox" class="loot-filter-checkbox accent-slate-800" data-rarity="normal">
                        ãƒãƒ¼ãƒãƒ«
                    </span>
                    <span class="text-[10px] text-slate-400 font-bold">æ‹¾ã‚ãªã„</span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-magic">
                        <input type="checkbox" class="loot-filter-checkbox accent-slate-800" data-rarity="magic">
                        ãƒã‚¸ãƒƒã‚¯
                    </span>
                    <span class="text-[10px] text-slate-400 font-bold">æ‹¾ã‚ãªã„</span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-rare">
                        <input type="checkbox" class="loot-filter-checkbox accent-slate-800" data-rarity="rare">
                        ãƒ¬ã‚¢
                    </span>
                    <span class="text-[10px] text-slate-400 font-bold">æ‹¾ã‚ãªã„</span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-epic">
                        <input type="checkbox" class="loot-filter-checkbox accent-slate-800" data-rarity="epic">
                        ã‚¨ãƒ”ãƒƒã‚¯
                    </span>
                    <span class="text-[10px] text-slate-400 font-bold">æ‹¾ã‚ãªã„</span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-legendary">
                        <input type="checkbox" class="loot-filter-checkbox accent-slate-800" data-rarity="legendary">
                        ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼
                    </span>
                    <span class="text-[10px] text-slate-400 font-bold">æ‹¾ã‚ãªã„</span>
                </label>
                <label class="hidden flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-mythic">
                        <input type="checkbox" class="loot-filter-checkbox accent-slate-800" data-rarity="mythic">
                        ãƒŸã‚·ãƒƒã‚¯
                    </span>
                    <span class="text-[10px] text-slate-400 font-bold">æ‹¾ã‚ãªã„</span>
                </label>
            </div>
            <button id="loot-filter-close-bottom" class="mt-5 w-full bg-slate-800 text-white font-black py-3 rounded-2xl shadow-lg">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- BULK SELL MODAL -->
    <div id="bulk-sell-modal" class="fixed inset-0 bg-slate-900/80 z-[106] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-amber-100">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-black text-lg text-slate-800 flex items-center gap-2">
                    <i class="fas fa-sack-dollar text-amber-500"></i> ä¸€æ‹¬å£²å´
                </h3>
                <button id="bulk-sell-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <p class="text-xs text-slate-500 mb-4">å£²ã‚ŠãŸã„ãƒ¬ã‚¢åº¦ã‚’è¤‡æ•°é¸æŠã—ã¦ã€ä¸€æ‹¬ã§å£²å´ã—ã¾ã™ã€‚</p>
            <div class="space-y-2 text-sm">
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-normal">
                        <input type="checkbox" class="bulk-sell-checkbox accent-amber-500" data-rarity="normal">
                        ãƒãƒ¼ãƒãƒ«
                    </span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-magic">
                        <input type="checkbox" class="bulk-sell-checkbox accent-amber-500" data-rarity="magic">
                        ãƒã‚¸ãƒƒã‚¯
                    </span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-rare">
                        <input type="checkbox" class="bulk-sell-checkbox accent-amber-500" data-rarity="rare">
                        ãƒ¬ã‚¢
                    </span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-epic">
                        <input type="checkbox" class="bulk-sell-checkbox accent-amber-500" data-rarity="epic">
                        ã‚¨ãƒ”ãƒƒã‚¯
                    </span>
                </label>
                <label class="flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-legendary">
                        <input type="checkbox" class="bulk-sell-checkbox accent-amber-500" data-rarity="legendary">
                        ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼
                    </span>
                </label>
                <label class="hidden flex items-center justify-between bg-slate-50 border border-slate-100 rounded-xl px-3 py-2">
                    <span class="flex items-center gap-2 font-bold rarity-mythic">
                        <input type="checkbox" class="bulk-sell-checkbox accent-amber-500" data-rarity="mythic">
                        ãƒŸã‚·ãƒƒã‚¯
                    </span>
                </label>
            </div>
            <div class="mt-5 space-y-2">
                <button id="bulk-sell-confirm" class="w-full bg-amber-500 text-white font-black py-3 rounded-2xl shadow-lg">å£²å´ï¼</button>
                <button id="bulk-sell-close-bottom" class="w-full bg-slate-100 text-slate-500 font-black py-3 rounded-2xl shadow">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- EQUIP SLOT MODAL -->
    <div id="equip-slot-modal" class="fixed inset-0 bg-slate-900/80 z-[108] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-slate-200">
            <div class="flex items-center justify-between mb-4">
                <h3 id="equip-slot-title" class="font-black text-lg text-slate-800 flex items-center gap-2"></h3>
                <button id="equip-slot-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <div class="space-y-3">
                <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3 space-y-2">
                    <div id="equip-slot-1-label" class="flex items-center justify-between text-[11px] font-black text-slate-600"></div>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="equip-slot-1" class="w-full bg-slate-800 text-white font-black py-2 rounded-2xl shadow-lg text-[11px] flex items-center justify-center gap-2">
                            <i class="fas fa-shield"></i>è£…å‚™
                        </button>
                        <button id="equip-slot-1-compare" class="w-full bg-white border border-slate-200 text-slate-600 font-black py-2 rounded-2xl shadow text-[11px] flex items-center justify-center gap-2">
                            <i class="fas fa-scale-balanced"></i>æ¯”è¼ƒ
                        </button>
                    </div>
                </div>
                <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3 space-y-2">
                    <div id="equip-slot-2-label" class="flex items-center justify-between text-[11px] font-black text-slate-600"></div>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="equip-slot-2" class="w-full bg-slate-800 text-white font-black py-2 rounded-2xl shadow-lg text-[11px] flex items-center justify-center gap-2">
                            <i class="fas fa-shield"></i>è£…å‚™
                        </button>
                        <button id="equip-slot-2-compare" class="w-full bg-white border border-slate-200 text-slate-600 font-black py-2 rounded-2xl shadow text-[11px] flex items-center justify-center gap-2">
                            <i class="fas fa-scale-balanced"></i>æ¯”è¼ƒ
                        </button>
                    </div>
                </div>
            </div>
            <button id="equip-slot-close-bottom" class="mt-5 w-full bg-slate-100 text-slate-500 font-black py-3 rounded-2xl shadow">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <!-- BUILD PRESET MODAL -->
    <div id="build-preset-modal" class="fixed inset-0 bg-slate-900/80 z-[111] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-indigo-100 max-h-[88dvh] overflow-y-auto">
            <div class="flex items-center justify-between mb-3">
                <h3 class="font-black text-lg text-slate-800 flex items-center gap-2"><i class="fas fa-layer-group text-indigo-500"></i> ãƒ—ãƒªã‚»ãƒƒãƒˆ</h3>
                <button id="build-preset-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <p class="text-[11px] text-slate-500 mb-4">ä¿å­˜å†…å®¹ã¯ç¾åœ¨æœªå®Ÿè£…ã§ã™ã€‚</p>
            <div id="build-preset-list" class="space-y-3"></div>
            <button id="build-preset-close-bottom" class="mt-5 w-full bg-slate-100 text-slate-500 font-black py-3 rounded-2xl shadow">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- COMPARE MODAL -->
    <div id="compare-modal" class="fixed inset-0 bg-slate-900/80 z-[112] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-emerald-100">
            <div class="flex items-center justify-between mb-3">
                <h3 class="font-black text-lg text-slate-800 flex items-center gap-2"><i class="fas fa-scale-balanced"></i> è£…å‚™æ¯”è¼ƒ</h3>
                <button id="compare-modal-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <div class="text-[11px] text-slate-500 font-bold flex items-center justify-between gap-2">
                <div class="flex-1 min-w-0">
                    <div class="text-[9px] text-slate-400 uppercase tracking-widest">ç¾åœ¨è£…å‚™</div>
                    <div id="compare-modal-equipped" class="text-slate-700 font-black truncate"></div>
                </div>
                <div class="flex-1 min-w-0 text-right">
                    <div class="text-[9px] text-slate-400 uppercase tracking-widest">å€™è£œè£…å‚™</div>
                    <div id="compare-modal-candidate" class="text-slate-800 font-black truncate"></div>
                </div>
            </div>
            <div class="mt-4 space-y-3">
                <div>
                    <div class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">å¢—åŠ </div>
                    <div id="compare-modal-increase" class="mt-1 space-y-1"></div>
                </div>
                <div>
                    <div class="text-[10px] font-black text-rose-500 uppercase tracking-widest">æ¸›å°‘</div>
                    <div id="compare-modal-decrease" class="mt-1 space-y-1"></div>
                </div>
            </div>
            <div class="mt-4 space-y-2">
                <button id="compare-modal-equip" class="w-full bg-slate-800 text-white font-black py-3 rounded-2xl shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-shield"></i>è£…å‚™ã™ã‚‹
                </button>
                <button id="compare-modal-close-bottom" class="w-full bg-slate-100 text-slate-500 font-black py-3 rounded-2xl shadow">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div id="confirm-modal" class="fixed inset-0 bg-slate-900/80 z-[125] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-rose-100 text-center space-y-4">
            <div class="text-rose-500 text-3xl"><i class="fas fa-triangle-exclamation"></i></div>
            <h3 class="text-base font-black text-slate-800">ç¢ºèª</h3>
            <p id="confirm-modal-message" class="text-xs text-slate-500"></p>
            <div class="grid grid-cols-2 gap-3 pt-2">
                <button id="confirm-modal-cancel" class="py-2 rounded-xl bg-slate-100 text-slate-600 text-[10px] font-black">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button id="confirm-modal-ok" class="py-2 rounded-xl bg-rose-500 text-white text-[10px] font-black hover:bg-rose-600 transition">å®Ÿè¡Œ</button>
            </div>
        </div>
    </div>

    <!-- ENHANCE MODAL -->
    <div id="enhance-modal" class="fixed inset-0 bg-slate-900/80 z-[130] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-slate-200">
            <div class="flex items-center justify-between mb-4">
                <h3 id="enhance-modal-title" class="font-black text-lg text-slate-800 flex items-center gap-2"></h3>
                <button id="enhance-modal-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <div id="enhance-modal-info" class="space-y-2 text-xs text-slate-600">
                <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-500">ç¾åœ¨ã®å¼·åŒ–å€¤</span>
                    <span id="enhance-modal-level" class="font-black text-slate-700"></span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-500">å¼·åŒ–è²»ç”¨</span>
                    <span id="enhance-modal-cost" class="font-black text-slate-700"></span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="font-bold text-slate-500">æˆåŠŸæ™‚ã‚¢ãƒƒãƒ—è¦‹è¾¼ã¿</span>
                    <span id="enhance-modal-preview" class="font-black text-emerald-600"></span>
                </div>
                <div id="enhance-modal-warning" class="text-[10px] text-rose-500 font-bold"></div>
            </div>
            <button id="enhance-modal-start" class="mt-4 w-full bg-slate-800 text-white font-black py-3 rounded-2xl shadow-lg">å¼·åŒ–</button>
            <div id="enhance-modal-progress" class="hidden mt-6 text-center space-y-3">
                <div class="w-16 h-16 mx-auto rounded-2xl bg-slate-100 flex items-center justify-center text-slate-600 enhance-rattle">
                    <i class="fas fa-hammer text-2xl"></i>
                </div>
                <div class="font-black text-slate-700">é›å†¶ä¸­...</div>
                <div class="text-[10px] text-slate-400">ã‚¿ãƒƒãƒ—ã§ã‚¹ã‚­ãƒƒãƒ—</div>
            </div>
            <div id="enhance-modal-result" class="hidden mt-6 text-center space-y-3">
                <div id="enhance-modal-result-icon" class="w-16 h-16 mx-auto rounded-2xl bg-slate-100 flex items-center justify-center text-2xl"></div>
                <div id="enhance-modal-result-title" class="font-black text-lg"></div>
                <div id="enhance-modal-result-detail" class="text-xs font-bold text-slate-600"></div>
                <div id="enhance-modal-result-extra" class="text-[10px] text-slate-400"></div>
                <button id="enhance-modal-repeat" class="w-full bg-slate-800 text-white font-black py-2.5 rounded-xl shadow flex items-center justify-center gap-2">
                    <i class="fas fa-hammer"></i>
                    <span>å¼·åŒ–ã™ã‚‹</span>
                </button>
                <div class="text-[10px] text-slate-400">ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹</div>
            </div>
        </div>
    </div>

    <!-- STATUS INFO MODAL -->
    <div id="status-info-modal" class="fixed inset-0 bg-slate-900/80 z-[110] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2rem] overflow-x-hidden overflow-y-auto max-h-[calc(100dvh-3rem)] no-scrollbar shadow-2xl p-6 border-b-8 border-slate-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-black text-lg text-slate-800 flex items-center gap-2">
                    <i class="fas fa-circle-info text-slate-500"></i> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒ¢
                </h3>
                <button id="status-info-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <div class="space-y-4 text-xs text-slate-600">
                <div>
                    <div class="text-[10px] font-black text-slate-400 uppercase">Primary</div>
                    <ul class="mt-2 space-y-1">
                        <li><span class="font-bold text-slate-700">STR</span>ï¼šç‰©ç†æ”»æ’ƒã®åŸºç¤å€¤ã€‚æ­¦å™¨ã®ATKã¨åˆç®—ã•ã‚Œã¾ã™ã€‚</li>
                        <li><span class="font-bold text-slate-700">VIT</span>ï¼šè¢«ãƒ€ãƒ¡ãƒ¼ã‚¸è»½æ¸›ã®åŸºç¤å€¤ã€‚é˜²å…·DEFã¨åˆç®—ã•ã‚Œã¾ã™ã€‚</li>
                        <li><span class="font-bold text-slate-700">INT</span>ï¼šé­”æ³•æ”»æ’ƒã®åŸºç¤å€¤ã€‚å›å¾©é‡ã«ã‚‚å½±éŸ¿ã€‚</li>
                        <li><span class="font-bold text-slate-700">DEX</span>ï¼šå™¨ç”¨ã•ã®åŸºç¤å€¤ã€‚å‘½ä¸­ãƒ»å›é¿ãƒ»ä¼šå¿ƒç‡ãƒ»ä¼šå¿ƒãƒ€ãƒ¡ãƒ¼ã‚¸ã«å½±éŸ¿ã€‚</li>
                    </ul>
                </div>
                <div>
                    <div class="text-[10px] font-black text-slate-400 uppercase">Secondary</div>
                    <ul class="mt-2 space-y-1">
                        <li>æœ€å¤§HPï¼šHPã‚’å›ºå®šå€¤ã§å¢—åŠ ã€‚</li>
                        <li>æœ€å¤§MPï¼šMPã‚’å›ºå®šå€¤ã§å¢—åŠ ã€‚</li>
                        <li>HPè‡ªå‹•å›å¾©ï¼šã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã«HPãŒå›å¾©ã€‚</li>
                        <li>MPè‡ªå‹•å›å¾©ï¼šã‚¿ãƒ¼ãƒ³çµ‚äº†æ™‚ã«MPãŒå›å¾©ã€‚</li>
                        <li>æ”»æ’ƒåŠ›ï¼šç‰©ç†æ”»æ’ƒã®å›ºå®šå¢—åŠ ã€‚</li>
                        <li>é˜²å¾¡åŠ›ï¼šé˜²å¾¡ã®å›ºå®šå¢—åŠ ã€‚</li>
                        <li>å‘½ä¸­ç‡ï¼šæ”»æ’ƒãŒå‘½ä¸­ã™ã‚‹ç¢ºç‡ã€‚</li>
                        <li>ä¼šå¿ƒç‡ï¼šã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãŒç™ºç”Ÿã™ã‚‹ç¢ºç‡ã€‚</li>
                        <li>ä¼šå¿ƒãƒ€ãƒ¡ãƒ¼ã‚¸ï¼šä¼šå¿ƒæ™‚ã®ãƒ€ãƒ¡ãƒ¼ã‚¸å€ç‡ã€‚</li>
                        <li>ä¸ãƒ€ãƒ¡å¢—åŠ ï¼šé€šå¸¸æ”»æ’ƒãƒ»ã‚¹ã‚­ãƒ«å…¨ä½“ã®ä¸ãƒ€ãƒ¡è£œæ­£ã€‚</li>
                        <li>è¢«ãƒ€ãƒ¡è»½æ¸›ï¼šæ•µæ”»æ’ƒã®æœ€çµ‚ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’è»½æ¸›ã€‚</li>
                        <li>å›é¿ç‡ï¼šæ•µã®æ”»æ’ƒã‚’å›é¿ã™ã‚‹ç¢ºç‡ã€‚</li>
                        <li>å¸è¡€ç‡ï¼šä¸ãˆãŸãƒ€ãƒ¡ãƒ¼ã‚¸ã®ä¸€éƒ¨ã‚’HPå›å¾©ã€‚</li>
                        <li>é­”æ³•è²«é€šï¼šæ•µã®é˜²å¾¡ã‚’ç„¡è¦–ã™ã‚‹å‰²åˆï¼ˆé­”æ³•ç³»ã‚¹ã‚­ãƒ«å‘ã‘ï¼‰ã€‚</li>
                        <li>è¿½åŠ çµŒé¨“å€¤ï¼šç²å¾—çµŒé¨“å€¤ã®å¢—åŠ ç‡ã€‚</li>
                        <li>ãƒ‰ãƒ­ãƒƒãƒ—ç‡ï¼šæˆ¦åˆ©å“ãŒå‡ºã‚‹ç¢ºç‡ã®ä¸Šæ˜‡ã€‚</li>
                        <li>ãƒ¬ã‚¢ãƒ‰ãƒ­ç‡ï¼šãƒ‰ãƒ­ãƒƒãƒ—å“ã®ãƒ¬ã‚¢åº¦ä¸Šæ˜‡ç¢ºç‡ã€‚</li>
                        <li>Affixç‡ï¼šè£…å‚™ã«AffixãŒä»˜ä¸ã•ã‚Œã‚‹ç¢ºç‡ã¨ãƒ©ãƒ³ã‚¯ä¸Šæ˜‡ç‡ã€‚</li>
                        <li>ã‚¨ãƒªãƒ¼ãƒˆé­é‡ç‡ï¼šã‚¨ãƒªãƒ¼ãƒˆãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®å‡ºç¾ç‡ãŒä¸Šæ˜‡ã€‚</li>
                        <li>ã‚´ãƒ¼ãƒ«ãƒ‰å¢—åŠ ç‡ï¼šç²å¾—ã‚´ãƒ¼ãƒ«ãƒ‰ã®å¢—åŠ ç‡ã€‚</li>
                    </ul>
                </div>
            </div>
            <button id="status-info-close-bottom" class="mt-5 w-full bg-slate-800 text-white font-black py-3 rounded-2xl shadow-lg">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- WARP MODAL -->
    <div id="warp-modal" class="fixed inset-0 bg-slate-900/80 z-[115] hidden items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] shadow-2xl p-6 border-b-8 border-slate-200">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-black text-lg text-slate-800 flex items-center gap-2"><i class="fas fa-location-arrow"></i> ãƒ¯ãƒ¼ãƒ—</h3>
                <button id="warp-close" class="text-slate-400 hover:text-slate-700 text-lg"><i class="fas fa-xmark"></i></button>
            </div>
            <div class="text-xs text-slate-500 font-bold">-</div>
        </div>
    </div>

    <!-- DONATE MODAL -->
    <div id="donate-modal" class="fixed inset-0 bg-slate-900/80 z-[120] hidden items-center justify-center p-6 backdrop-blur-sm">
      <div class="bg-white w-full max-w-sm rounded-[2rem] overflow-hidden shadow-2xl p-6 border-b-8 border-amber-200">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-black text-lg text-slate-800 flex items-center gap-2">
            <i class="fas fa-heart text-rose-500"></i> å¿œæ´
          </h3>
          <button class="text-slate-400 hover:text-slate-700 text-lg" onclick="closeDonateModal()">
            <i class="fas fa-xmark"></i>
          </button>
        </div>
    
        <div class="text-[11px] text-slate-600 font-bold mb-4">
          æ°—ãŒå‘ã„ãŸã‚‰ã§å¤§ä¸ˆå¤«ã§ã™ã€‚é–‹ç™ºã®åŠ±ã¿ã«ãªã‚Šã¾ã™ã€‚
        </div>
    
        <div class="space-y-3">
          <button class="w-full bg-white text-slate-900 border border-slate-900 font-black py-3 rounded-2xl shadow-sm flex items-center justify-center gap-2 hover:bg-slate-100 transition"
            onclick="purchaseTip('tip100',event)">
            â˜•ï¸ 100å††ï¼ˆã‚³ãƒ¼ãƒ’ãƒ¼ï¼‰
          </button>
    
          <button class="w-full bg-white text-slate-900 border border-slate-900 font-black py-3 rounded-2xl shadow-sm flex items-center justify-center gap-2 hover:bg-slate-100 transition"
            onclick="purchaseTip('tip300',event)">
            â˜•ï¸ğŸª 300å††ï¼ˆã‚³ãƒ¼ãƒ’ãƒ¼ï¼‹ãŠè“å­ï¼‰
          </button>
    
          <button class="w-full bg-white text-slate-900 font-black rounded-2xl flex items-center justify-center"
            >
            ğŸ”¥ æœ¬å½“ã«å¿œæ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™
          </button>
        </div>
    
        <button class="mt-5 w-full bg-slate-100 text-slate-500 font-black py-3 rounded-2xl shadow"
          onclick="closeDonateModal()">
          ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
      </div>
    </div>
    
    <!-- DONATE TOAST -->
    <div id="donate-toast" class="fixed left-1/2 -translate-x-1/2 bottom-24 z-[130] hidden">
      <div class="bg-white/95 border border-slate-200 shadow-xl rounded-2xl px-4 py-3 text-[12px] font-black text-slate-800">
        <span id="donate-toast-text"></span>
      </div>
    </div>

    <div id="boot-overlay" class="fixed inset-0 z-[160] hidden bg-slate-900/40 flex items-center justify-center">
      <div class="bg-white/90 text-slate-700 font-black text-sm px-4 py-2 rounded-xl shadow">
        ãƒ­ãƒ¼ãƒ‰ä¸­â€¦
      </div>
    </div>


    <script>
        (() => {
            const COMBAT_CONSTANTS = Object.freeze({
                DEX_PER_BONUS_HIT_CAP: 100,
                DOUBLE_CRITICAL_LUCK_GAP: 400,
                CRITICAL_MULTIPLIER: 2,
                DOUBLE_CRITICAL_MULTIPLIER: 4,
                BONUS_ON_HIT_STATUS_AILMENT_SCALE: 0.5,
                BONUS_ON_HIT_DRAIN_SCALE: 0.3
            });

            const PrimaryStatKey = Object.freeze({
                STR: 'STR',
                INT: 'INT',
                VIT: 'VIT',
                DEX: 'DEX',
                LUK: 'LUK'
            });

            const SecondaryStatKey = Object.freeze({
                MaxHP: 'MaxHP',
                MaxMP: 'MaxMP',
                PhysicalAttack: 'PhysicalAttack',
                MagicAttack: 'MagicAttack',
                Defense: 'Defense',
                HitRate: 'HitRate',
                AvoidRate: 'AvoidRate',
                CriticalChance: 'CriticalChance',
                BonusDamagePercent: 'BonusDamagePercent',
                BonusDefensePercent: 'BonusDefensePercent',
                DropRateBonus: 'DropRateBonus',
                RareDropRateBonus: 'RareDropRateBonus',
                EnchantSuccessRateBonus: 'EnchantSuccessRateBonus',
                GoldGainRate: 'GoldGainRate',
                ExpGainRate: 'ExpGainRate'
            });

            const HitSourceType = Object.freeze({
                Guaranteed: 'Guaranteed',
                Bonus: 'Bonus'
            });

            const CritTier = Object.freeze({
                None: 'None',
                Critical: 'Critical',
                DoubleCritical: 'DoubleCritical'
            });

            const createPrimaryStats = (stats = {}) => ({
                [PrimaryStatKey.STR]: Number.isFinite(stats[PrimaryStatKey.STR]) ? Math.max(0, Math.floor(stats[PrimaryStatKey.STR])) : 0,
                [PrimaryStatKey.INT]: Number.isFinite(stats[PrimaryStatKey.INT]) ? Math.max(0, Math.floor(stats[PrimaryStatKey.INT])) : 0,
                [PrimaryStatKey.VIT]: Number.isFinite(stats[PrimaryStatKey.VIT]) ? Math.max(0, Math.floor(stats[PrimaryStatKey.VIT])) : 0,
                [PrimaryStatKey.DEX]: Number.isFinite(stats[PrimaryStatKey.DEX]) ? Math.max(0, Math.floor(stats[PrimaryStatKey.DEX])) : 0,
                [PrimaryStatKey.LUK]: Number.isFinite(stats[PrimaryStatKey.LUK]) ? Math.max(0, Math.floor(stats[PrimaryStatKey.LUK])) : 0
            });

            const createSecondaryStats = (stats = {}) => {
                const pickFlat = (key) => (Number.isFinite(stats[key]) ? Math.max(0, Number(stats[key])) : 0);
                const pickRate = (key, min = 0, max = 1) => {
                    const value = Number.isFinite(stats[key]) ? Number(stats[key]) : 0;
                    return Math.min(max, Math.max(min, value));
                };

                return {
                    [SecondaryStatKey.MaxHP]: pickFlat(SecondaryStatKey.MaxHP),
                    [SecondaryStatKey.MaxMP]: pickFlat(SecondaryStatKey.MaxMP),
                    [SecondaryStatKey.PhysicalAttack]: pickFlat(SecondaryStatKey.PhysicalAttack),
                    [SecondaryStatKey.MagicAttack]: pickFlat(SecondaryStatKey.MagicAttack),
                    [SecondaryStatKey.Defense]: pickFlat(SecondaryStatKey.Defense),
                    [SecondaryStatKey.HitRate]: pickFlat(SecondaryStatKey.HitRate),
                    [SecondaryStatKey.AvoidRate]: pickRate(SecondaryStatKey.AvoidRate, 0, 0.95),
                    [SecondaryStatKey.CriticalChance]: pickRate(SecondaryStatKey.CriticalChance),
                    [SecondaryStatKey.BonusDamagePercent]: pickRate(SecondaryStatKey.BonusDamagePercent, -0.99, 10),
                    [SecondaryStatKey.BonusDefensePercent]: pickRate(SecondaryStatKey.BonusDefensePercent, -0.99, 10),
                    [SecondaryStatKey.DropRateBonus]: pickRate(SecondaryStatKey.DropRateBonus, -0.99, 10),
                    [SecondaryStatKey.RareDropRateBonus]: pickRate(SecondaryStatKey.RareDropRateBonus, -0.99, 10),
                    [SecondaryStatKey.EnchantSuccessRateBonus]: pickRate(SecondaryStatKey.EnchantSuccessRateBonus, -0.99, 10),
                    [SecondaryStatKey.GoldGainRate]: pickRate(SecondaryStatKey.GoldGainRate, -0.99, 10),
                    [SecondaryStatKey.ExpGainRate]: pickRate(SecondaryStatKey.ExpGainRate, -0.99, 10)
                };
            };

            class HitSequenceResolver {
                static resolve({ attackDefinition, attackerDex, rng = Math.random }) {
                    const guaranteedHits = Math.max(0, Math.floor(attackDefinition.guaranteedHits || 0));
                    const skillBonusHitCap = Math.max(0, Math.floor(attackDefinition.skillBonusHitCap || 0));
                    const dexBonusHitCap = Math.floor(Math.max(0, attackerDex || 0) / COMBAT_CONSTANTS.DEX_PER_BONUS_HIT_CAP);
                    const actualBonusHitCap = Math.min(dexBonusHitCap, skillBonusHitCap);
                    const bonusHitChanceTable = Array.isArray(attackDefinition.bonusHitChanceTable) ? attackDefinition.bonusHitChanceTable : [];
                    const bonusHitDamageScaleTable = Array.isArray(attackDefinition.bonusHitDamageScaleTable) ? attackDefinition.bonusHitDamageScaleTable : [];

                    const hitSequence = [];
                    for (let i = 0; i < guaranteedHits; i += 1) {
                        hitSequence.push({
                            hitSourceType: HitSourceType.Guaranteed,
                            isGuaranteedHit: true,
                            damageScale: 1,
                            bonusSlotIndex: null,
                            onHitEffectScale: 1
                        });
                    }

                    for (let i = 0; i < actualBonusHitCap; i += 1) {
                        const chance = HitSequenceResolver.#pickTableValue(bonusHitChanceTable, i, 0);
                        if (rng() < chance) {
                            hitSequence.push({
                                hitSourceType: HitSourceType.Bonus,
                                isGuaranteedHit: false,
                                damageScale: HitSequenceResolver.#pickTableValue(bonusHitDamageScaleTable, i, 0),
                                bonusSlotIndex: i,
                                onHitEffectScale: {
                                    statusAilment: COMBAT_CONSTANTS.BONUS_ON_HIT_STATUS_AILMENT_SCALE,
                                    hpMpDrain: COMBAT_CONSTANTS.BONUS_ON_HIT_DRAIN_SCALE,
                                    triggerPolicy: 'OncePerAction'
                                }
                            });
                        }
                    }

                    return hitSequence.map((hit, index) => ({ ...hit, hitIndex: index }));
                }

                static #pickTableValue(table, index, fallback) {
                    if (!table.length) {
                        return fallback;
                    }

                    const picked = index < table.length ? table[index] : table[table.length - 1];
                    return Number.isFinite(picked) ? picked : fallback;
                }
            }

            class CriticalResolver {
                static resolveCritTier({ isCritical, attackerLuk, defenderLuk }) {
                    if (!isCritical) {
                        return CritTier.None;
                    }

                    const luckGap = (attackerLuk || 0) - (defenderLuk || 0);
                    if (luckGap >= COMBAT_CONSTANTS.DOUBLE_CRITICAL_LUCK_GAP) {
                        return CritTier.DoubleCritical;
                    }

                    return CritTier.Critical;
                }

                static getCritMultiplier(critTier) {
                    if (critTier === CritTier.DoubleCritical) {
                        return COMBAT_CONSTANTS.DOUBLE_CRITICAL_MULTIPLIER;
                    }
                    if (critTier === CritTier.Critical) {
                        return COMBAT_CONSTANTS.CRITICAL_MULTIPLIER;
                    }
                    return 1;
                }
            }

            const resolveHitResults = ({
                attackDefinition,
                attackerPrimaryStats,
                defenderPrimaryStats,
                attackerSecondaryStats,
                defenderSecondaryStats,
                rollCritical,
                rng = Math.random
            }) => {
                const attacker = createPrimaryStats(attackerPrimaryStats);
                const defender = createPrimaryStats(defenderPrimaryStats);
                const attackerSecondary = createSecondaryStats(attackerSecondaryStats);
                const defenderSecondary = createSecondaryStats(defenderSecondaryStats);
                const hitSequence = HitSequenceResolver.resolve({
                    attackDefinition,
                    attackerDex: attacker.DEX,
                    rng
                });

                const rollCriticalBySecondary = ({ rng: random }) => {
                    const criticalChance = attackerSecondary.CriticalChance;
                    return random() < criticalChance;
                };

                const resolveCritical = typeof rollCritical === 'function'
                    ? rollCritical
                    : rollCriticalBySecondary;

                return hitSequence.map((hit) => {
                    const isCritical = !!resolveCritical({
                        hit,
                        attacker,
                        defender,
                        attackerSecondary,
                        defenderSecondary,
                        rng
                    });
                    const critTier = CriticalResolver.resolveCritTier({
                        isCritical,
                        attackerLuk: attacker.LUK,
                        defenderLuk: defender.LUK
                    });

                    return {
                        ...hit,
                        critTier,
                        critMultiplier: CriticalResolver.getCritMultiplier(critTier)
                    };
                });
            };

            const NORMAL_ATTACK_HIT_DEFINITION = Object.freeze({
                guaranteedHits: 1,
                skillBonusHitCap: 3,
                bonusHitChanceTable: [0.6, 0.35, 0.2, 0.1, 0.05, 0.05],
                bonusHitDamageScaleTable: [0.7, 0.55, 0.4, 0.3, 0.3]
            });

            window.CombatSpec = Object.freeze({
                COMBAT_CONSTANTS,
                PrimaryStatKey,
                SecondaryStatKey,
                HitSourceType,
                CritTier,
                createPrimaryStats,
                createSecondaryStats,
                HitSequenceResolver,
                CriticalResolver,
                resolveHitResults,
                NORMAL_ATTACK_HIT_DEFINITION
            });

            const statValueIds = [
                'player-hp-text', 'player-mp-text', 'player-exp-text-battle',
                'enemy-hp-text', 'enemy-name',
                'status-lvl', 'status-atk', 'status-def', 'status-int', 'status-dex',
                'status-exp', 'status-next',
                'stat-max-hp', 'stat-max-mp', 'stat-hp-regen', 'stat-mp-regen',
                'stat-atk-flat', 'stat-def-flat', 'stat-hit', 'stat-crit', 'stat-crit-dmg',
                'stat-dmg', 'stat-dr', 'stat-eva', 'stat-lifesteal', 'stat-magic-pen',
                'stat-exp-bonus', 'stat-drop', 'stat-rare-drop', 'stat-affix-find'
            ];

            const setDashValues = () => {
                statValueIds.forEach((id) => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.innerText = '-';
                    }
                });

                ['player-hp-bar', 'player-mp-bar', 'player-exp-bar-battle', 'enemy-hp-bar', 'status-exp-bar'].forEach((id) => {
                    const bar = document.getElementById(id);
                    if (bar) bar.style.width = '0%';
                });

                ['battle-log', 'drop-log-list'].forEach((id) => {
                    const el = document.getElementById(id);
                    if (el) el.innerHTML = '';
                });
            };

            const noop = (event) => {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                return false;
            };

            window.switchPage = noop;
            window.toggleBottomMenu = noop;
            window.closeBottomMenu = noop;
            window.openBottomMenuHelp = noop;
            window.openBottomMenuSave = noop;
            window.openBottomMenuDonate = noop;
            window.openBottomMenuTweet = noop;
            window.openBottomMenuFeedback = noop;
            window.openDonateModal = noop;
            window.closeDonateModal = noop;
            window.purchaseTip = noop;
            window.openXShare = noop;

            document.addEventListener('DOMContentLoaded', () => {
                try {
                    localStorage.clear();
                } catch (e) {
                    // noop
                }

                setDashValues();

                const overlay = document.getElementById('boot-overlay');
                if (overlay) overlay.style.display = 'none';
                document.body.classList.remove('is-booting');

                const actionBtn = document.getElementById('action-btn');
                if (actionBtn) {
                    actionBtn.addEventListener('click', noop);
                }

                const warpModal = document.getElementById('warp-modal');
                const warpBtn = document.getElementById('warp-btn');
                const warpClose = document.getElementById('warp-close');
                if (warpBtn && warpModal) {
                    warpBtn.addEventListener('click', (event) => {
                        event.preventDefault();
                        warpModal.classList.remove('hidden');
                        warpModal.classList.add('flex');
                    });
                }
                if (warpClose && warpModal) {
                    warpClose.addEventListener('click', (event) => {
                        event.preventDefault();
                        warpModal.classList.add('hidden');
                        warpModal.classList.remove('flex');
                    });
                }
                if (warpModal) {
                    warpModal.addEventListener('click', (event) => {
                        if (event.target === warpModal) {
                            warpModal.classList.add('hidden');
                            warpModal.classList.remove('flex');
                        }
                    });
                }
            });
        })();
    </script>
    </div>
</body>
</html>
